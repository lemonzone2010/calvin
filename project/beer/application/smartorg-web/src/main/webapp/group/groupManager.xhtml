<f:view xmlns="http://www.w3.org/1999/xhtml" xmlns:f="http://java.sun.com/jsf/core"
	xmlns:w="http://www.apusic.com/jsf/widget" xmlns:layout="http://www.apusic.com/jsf/layout"
	xmlns:h="http://java.sun.com/jsf/html" xmlns:ajax="http://www.apusic.com/jsf/ajax"
	xmlns:nsec="http://www.nsec.com" xmlns:om="http://www.apusic.com/jsf/misc"
	xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:c="http://java.sun.com/jstl/core" renderKitId="AJAX"
	xmlns:fn="http://java.sun.com/jsp/jstl/functions" xmlns:ebiz="http://www.apusic.com/framework-web">
	<ui:decorate template="/template/ebiz_smartorg_template.xhtml">
		<ui:param name="title" value="用户管理"></ui:param>
		<ui:define name="content">
				<om:useBean value="group.groupManagerBean"></om:useBean>
		<c:set var="bean" value="#{group.groupManagerBean}"/>
		<c:set var="newGroup" value="#{bean.newGroup}"/>
		<c:set var="parent" value="#{bean.parent}"/>

			<layout:borderLayout fitToBody="true">
				<layout:panel region="west" width="200" title="群组管理" split="true">
					<w:form groupId="treeFrom">
					<w:toolBar>
						<w:button id="addGroup" value="添加" tooltip="添加群组"></w:button><w:separator />
						<w:button id="updateGroup" value="修改" tooltip="修改群组"></w:button><w:separator />
						<w:button id="deleteGroup" value="删除" tooltip="删除群组"></w:button>
					</w:toolBar>
					<w:tree id="componentTree" border="false" style="height:100%;width:100%;" />
					</w:form>
				</layout:panel>
				<layout:panel region="center" title="用户管理">
						<w:form groupId="treeFrom">
					<w:dataGrid style="height: 500px" id="userGrid" paged="true" rows="10" border="false" toolBarPosition="bottom">
						<w:toolBar>
							<w:button id="addUser" value="添加" tooltip="添加用户"></w:button><w:separator />
							<w:button id="deleteUser" value="删除" tooltip="删除用户" onclick="javascript:if(confirm('确定删除这些用户吗？')){return true}else{return false;}"></w:button><w:separator />
							<w:button id="changePassword" value="修改密码" tooltip="修改密码"></w:button>
							<w:button id="addRole" value="添加角色" tooltip="添加角色"></w:button>
							<w:button id="removeRole" value="移除角色" tooltip="移除角色"></w:button>
						</w:toolBar>
            			<w:pagingToolbar  displayInfo="true" displayMsg="显示 {0} - {1}，共 {2} 条" />
        			</w:dataGrid>
            			</w:form>
				</layout:panel>
			</layout:borderLayout>


			<layout:window id="addGroupWindows" width="450" height="250" modal="true" resizable="false"	title="添加群组">
				<w:form id="treeAddForm">
					<table>
						<tr><td><h:outputLabel value="父群组编号:" /></td><td><w:textField value="#{group.groupManagerBean.parent.name}" disabled="true" alwaysSubmit="true"/></td></tr>
						<tr><td><h:outputLabel value="父群组:" /></td><td><w:textField value="#{group.groupManagerBean.parent.alias}" disabled="true" alwaysSubmit="true"/></td></tr>
						<tr><td><h:outputLabel value="群组编号:" /></td><td><h:inputText value="#{group.groupManagerBean.newGroup.name}" required="true"/></td></tr>
						<tr><td><h:outputLabel value="群组名称:" /></td><td><h:inputText value="#{group.groupManagerBean.newGroup.alias}" required="true"/></td></tr>
						<tr><td><h:outputLabel value="群组描述:" /></td><td><h:inputTextarea value="#{group.groupManagerBean.newGroup.desc}"/></td></tr>
						<tr><td><w:button style="margin-right: 10px" label="添加" id="submitAddGroup" alwaysSubmit="true"/></td>
							<td><w:button label="关闭" id="closeAddGroup" immediate="true"/></td></tr>
					</table>
				</w:form>
			</layout:window>

			<layout:window id="updateGroupWindows" width="450" height="250" modal="true" resizable="false"	title="修改群组">
				<w:form id="treeupdateForm">
					<table>
						<tr><td colspan="2"><w:textField value="#{group.groupManagerBean.newGroup.id}" hidden="true" disabled="true" alwaysSubmit="true" required="true"/></td></tr>
						<tr><td><h:outputLabel value="群组编号:" /></td><td><w:textField value="#{group.groupManagerBean.newGroup.name}" disabled="true" alwaysSubmit="true" required="true"/></td></tr>
						<tr><td><h:outputLabel value="群组名称:" /></td><td><h:inputText value="#{group.groupManagerBean.newGroup.alias}" required="true"/></td></tr>
						<tr><td><h:outputLabel value="群组描述:" /></td><td><h:inputTextarea value="#{group.groupManagerBean.newGroup.desc}"/></td></tr>
						<tr><td><w:button style="margin-right: 10px" label="修改" id="submitUpdateGroup" alwaysSubmit="true"/></td>
							<td><w:button label="关闭" id="closeUpdateGroup" immediate="true"/></td></tr>
					</table>
				</w:form>
			</layout:window>

			<layout:window id="deleteGroupWindows" width="450" height="250" modal="true" resizable="false"	title="删除群组">
				<w:form id="treeDeleteForm">
					<table>
						<tr><td><h:outputLabel value="群组编号:" /></td><td><w:textField value="#{group.groupManagerBean.newGroup.name}" disabled="true" alwaysSubmit="true" required="true"/></td></tr>
						<tr><td><h:outputLabel value="群组名称:" /></td><td><w:textField value="#{group.groupManagerBean.newGroup.alias}" required="true" alwaysSubmit="true" disabled="true"/></td></tr>
						<tr><td><h:outputLabel value="群组描述:" /></td><td><h:inputTextarea value="#{group.groupManagerBean.newGroup.desc}" disabled="true"/></td></tr>
						<tr><td colspan="2"><h:selectBooleanCheckbox id="isDeleteUser" title="isDeleteUser"/><h:outputText value="是否删除该组下面的用户？"/></td></tr>
						<tr><td><w:button style="margin-right: 10px" label="删除" id="submitDeleteGroup" alwaysSubmit="true"/></td>
							<td><w:button label="关闭" id="closeDeleteGroup" immediate="true"/></td></tr>
					</table>
				</w:form>
			</layout:window>


			<layout:window id="addUserWindows" width="400" height="200" modal="true" resizable="false">
				<w:form id="treeAddUserForm">
					<table>
						<tr><td colspan="2"><w:textField value="#{group.groupManagerBean.newGroup.name}" alwaysSubmit="true" hidden="true"/></td></tr>
						<tr><td><h:outputLabel value="用户名:" /></td><td><w:textField value="#{group.groupManagerBean.uiUser.name}" required="true"/></td></tr>
						<tr><td><h:outputLabel value="密码:" /></td><td><w:textField inputType="password" id="password" jsvar="password" value="#{group.groupManagerBean.uiUser.password}" required="true"/></td></tr>
						<tr><td><h:outputLabel value="确认密码:" /></td><td><w:textField inputType="password" validateEvents="onkeyup" id="passwordValidate" validatorMessage="密码确认与前一次不同，请重新输入" value="#{group.groupManagerBean.uiUser.password}" required="true">
							<ajax:clientValidator>
								return value==password.getValue();
							</ajax:clientValidator>
						</w:textField></td></tr>
						<tr><td><w:button style="margin-right: 10px" label="添加" id="submitAddUser" alwaysSubmit="true"/></td>
							<td><w:button label="关闭" id="closeAddUser" immediate="true"/></td></tr>
					</table>
				</w:form>
			</layout:window>

			<layout:window id="changePasswordWindow" width="400" height="200" modal="true" resizable="false">
				<w:form id="treechangePasswordForm">
					<table>
						<tr><td><h:outputLabel value="用户名:" /></td><td><w:textField value="#{group.groupManagerBean.uiUser.name}" required="true"/></td></tr>
						<tr><td><h:outputLabel value="旧密码:" /></td><td><w:textField inputType="password" id="oldpassword" jsvar="oldpassword" value="#{group.groupManagerBean.uiUser.password}" required="true"/></td></tr>
						<tr><td><h:outputLabel value="密码:" /></td><td><w:textField inputType="password" id="newpassword" jsvar="newpassword" value="#{group.groupManagerBean.newsPassword}" required="true"/></td></tr>
						<tr><td><h:outputLabel value="确认密码:" /></td><td><w:textField inputType="password" validateEvents="onkeyup" id="newpasswordValidate" validatorMessage="密码确认与前一次不同，请重新输入" value="#{group.groupManagerBean.newsPassword}" required="true">
							<ajax:clientValidator>
								return value==newpassword.getValue();
							</ajax:clientValidator>
						</w:textField></td></tr>
						<tr><td><w:button style="margin-right: 10px" label="修改密码" id="submitchangePassword" alwaysSubmit="true"/></td>
							<td><w:button label="关闭" id="closechangePassword" immediate="true"/></td></tr>
					</table>
				</w:form>
			</layout:window>

		<layout:window id="addRoleWindow" width="300" height="280" modal="true" resizable="false" title="选择角色" autoScroll="true">
			<w:form id="addRoleForm">
				<ebiz:simpleTree id="addrole" init="#{component.roleTreeBean.getRoles}" click="if(confirm('确认将该角色授权给您所选择的用户?')){submitAddRole.addParam('roleName',addrole.getSelectedNode().id);submitAddRole.submit();};"></ebiz:simpleTree>
			</w:form>
			<ajax:submitAction id="submitAddRole" jsvar="submitAddRole"></ajax:submitAction>
		</layout:window>

		<layout:window id="removeRoleWindow" width="300" height="280" modal="true" resizable="false" title="选择角色" autoScroll="true">
			<w:form id="removeRoleForm">
				<ebiz:simpleTree id="removeRole" init="#{component.roleTreeBean.getRoles}" click="if(confirm('确认选择的用户将该角色移除?')){submitRemoveRole.addParam('roleName',removeRole.getSelectedNode().id);submitRemoveRole.submit();};"></ebiz:simpleTree>
			</w:form>
			<ajax:submitAction id="submitRemoveRole" jsvar="submitRemoveRole"></ajax:submitAction>
		</layout:window>
		</ui:define>
	</ui:decorate>
</f:view>
